# è®²æ¸…æ¥š this

## å‰è¨€

æˆ‘ä¸ªäººæ„Ÿè§‰ï¼Œthis ä¹±æ˜¯å› ä¸º js è¯­æ³•æ ‡å‡†çš„ä¸æ–­æ›´æ–°ä»¥åŠ js æœ¬èº«çš„çµæ´»æ€§ï¼Œæœ‰åˆ©æœ‰å¼Šã€‚æ‰€ä»¥ this çš„æŒ‡å‘ç­‰é—®é¢˜è¿˜æ˜¯å¿…é¡»è¦å¼„æ¸…æ¥šçš„ï¼Œä¸ç„¶ bug éƒ½ä¸ä¼šæ”¹äº†ï¼Œè¿˜ä¼šå†™å‡ºä¸€å † bug

## æ­£æ–‡

JavaScript çš„ `this` æ˜¯åœ¨**è°ƒç”¨é˜¶æ®µ**è¿›è¡Œç»‘å®šçš„

### ä»€ä¹ˆæ˜¯ this

é¦–å…ˆå¯¹ this çš„ä¸‹ä¸ªå®šä¹‰ï¼š**this æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºæ—¶ç¡®å®šçš„ä¸€ä¸ªåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¸å¯æ›´æ”¹çš„å˜é‡**

æ‰€è°“**æ‰§è¡Œä¸Šä¸‹æ–‡**ï¼Œå°±æ˜¯ JavaScript å¼•æ“åœ¨æ‰§è¡Œä¸€æ®µä»£ç ä¹‹å‰å°†ä»£ç å†…éƒ¨ä¼šç”¨åˆ°çš„ä¸€äº›**å˜é‡**ã€**å‡½æ•°**ã€**this**æå‰å£°æ˜ç„¶åä¿å­˜åœ¨å˜é‡å¯¹è±¡ä¸­çš„è¿‡ç¨‹ã€‚è¿™ä¸ª'ä»£ç ç‰‡æ®µ'åŒ…æ‹¬ï¼š**å…¨å±€ä»£ç **(script æ ‡ç­¾å†…éƒ¨çš„ä»£ç )ã€**å‡½æ•°å†…éƒ¨ä»£ç **ã€**eval å†…éƒ¨ä»£ç **ã€‚è€Œæˆ‘ä»¬æ‰€ç†ŸçŸ¥çš„ä½œç”¨åŸŸé“¾ä¹Ÿä¼šåœ¨ä¿å­˜åœ¨è¿™é‡Œï¼Œä»¥ä¸€ä¸ªç±»æ•°ç»„çš„å½¢å¼å­˜å‚¨åœ¨å¯¹åº”å‡½æ•°çš„[[Scopes]]å±æ€§ä¸­ã€‚

å› ä¸ºæ˜¯åœ¨**æ‰§è¡Œä¸Šä¸‹æ–‡**ç¡®å®š thisï¼Œæ‰€ä»¥å°±äº§ç”Ÿäº†å¤šå˜æ€§ï¼Œå³ï¼š**å½“å‡½æ•°åœ¨ä¸åŒçš„è°ƒç”¨æ–¹å¼ä¸‹éƒ½å¯èƒ½ä¼šå¯¼è‡´ this çš„å€¼ä¸åŒã€‚**ã€

å…ˆç®€å•åŒºåˆ†ä»¥ä¸‹**ä¸¥æ ¼æ¨¡å¼**å’Œ**éä¸¥æ ¼æ¨¡å¼**

```js
// ä¸¥æ ¼æ¨¡å¼
var a = 1
function fun() {
  'use strict'
  var a = 2
  return this.a
}
fun() //æŠ¥é”™ Cannot read property 'a' of undefined
```

```js
// éä¸¥æ ¼æ¨¡å¼
var a = 1
function fun() {
  var a = 2
  return this.a
}
fun() //1
```

åœ¨çœ‹ä¸€ä¸ªå…³äº obj çš„ä¾‹å­ï¼š

ç»“è®ºï¼š**å½“å‡½æ•°ç‹¬ç«‹è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„ this æŒ‡å‘ undefinedï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå½“ this æŒ‡å‘ undefined çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­å°±æ˜¯ window)**

```js
var a = 1000
var obj = {
  a: 1,
  b: this.a + 1
}
function fun() {
  var obj = {
    a: 1,
    c: this.a + 2 //ä¸¥æ ¼æ¨¡å¼ä¸‹è¿™å—æŠ¥é”™ Cannot read property 'a' of undefined
  }
  return obj.c
}
console.log(fun()) //1002
console.log(obj.b) //1001
```

ç»“è®ºï¼š**å½“ obj åœ¨å…¨å±€å£°æ˜çš„æ—¶å€™ï¼Œobj å†…éƒ¨å±æ€§ä¸­çš„ this æŒ‡å‘å…¨å±€å¯¹è±¡ï¼Œå½“ obj åœ¨ä¸€ä¸ªå‡½æ•°ä¸­å£°æ˜çš„æ—¶å€™ï¼Œä¸¥æ ¼æ¨¡å¼ä¸‹ this ä¼šæŒ‡å‘ undefinedï¼Œéä¸¥æ ¼æ¨¡å¼è‡ªåŠ¨è½¬ä¸ºæŒ‡å‘å…¨å±€å¯¹è±¡ã€‚**

### ç›´æ¥è°ƒç”¨

```js
var a = 1
var obj = {
  a: 2,
  b: function () {
    function fun() {
      return this.a
    }
    console.log(fun())
  }
}
obj.b() //1
```

è¿™é‡Œä¹ä¸€çœ‹ï¼Œçœ‹ä¼¼æ˜¯ obj è°ƒç”¨æ–¹æ³•ï¼Œä½†å®é™…ä¸Šæœ€ç»ˆæ‰“å°çš„æ˜¯ fun(),æ‰€ä»¥æ˜¯ç‹¬ç«‹è°ƒç”¨å‡½æ•°
ç»“è®ºï¼š**å½“å‡½æ•°ç‹¬ç«‹è°ƒç”¨çš„æ—¶å€™ï¼Œåœ¨ä¸¥æ ¼æ¨¡å¼ä¸‹å®ƒçš„ this æŒ‡å‘ undefinedï¼Œåœ¨éä¸¥æ ¼æ¨¡å¼ä¸‹ï¼Œå½“ this æŒ‡å‘ undefined çš„æ—¶å€™ï¼Œè‡ªåŠ¨æŒ‡å‘å…¨å±€å¯¹è±¡(æµè§ˆå™¨ä¸­å°±æ˜¯ window)ã€‚**

### ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•

```js
var a = 1
var obj = {
  a: 2,
  b: function () {
    return this.a
  }
}
console.log(obj.b()) //2
```

è¿™é‡Œæœ€ç»ˆè°ƒç”¨çš„åœ°æ–¹æ˜¯ obj æ‰€ä»¥ this æŒ‡å‘ obj æ‰“å°çš„æ˜¯ obj ä¸‹é¢çš„ a

æ³¨æ„çœ‹ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š

```js
var a = 1
var obj = {
  a: 2,
  b: function () {
    return this.a
  }
}
var t = obj.b
console.log(t()) //1
```

è¿™é‡Œç”¨ t å­˜å‚¨äº† obj.b è¿™ä¸ªå‡½æ•°ï¼ˆå­˜çš„ b å‡½æ•°çš„æŒ‡é’ˆï¼Œæ‰€ä»¥ä¹‹åå°±å’Œ obj æ²¡æœ‰å…³ç³»äº†ï¼‰æ‰€ä»¥è¿™é‡Œæ‰§è¡Œæ—¶å°±æ˜¯å•ç‹¬è°ƒç”¨äº† b å‡½æ•° æ‰€ä»¥ this æŒ‡å‘äº† window

ç»“è®ºï¼š**æ‰€ä»¥ this å°±æ˜¯æ–¹æ³•è¢«è°ƒç”¨æ—¶çš„`ç›´æ¥è°ƒç”¨è€…`**

### ä½¿ç”¨ apply,call

ç»“è®ºï¼šthis æŒ‡å‘ apply å’Œ call æŒ‡å®šçš„å¯¹è±¡

é¡ºä¾¿è§£é‡Šä¸€ä¸‹ ä¸ºä»€ä¹ˆç›´æ¥è°ƒç”¨å‡½æ•° ä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘ undefined éä¸¥æ ¼æ¨¡å¼ä¸‹æŒ‡å‘ window

```js
var a = 1
function fun() {
  return this.a
}
fun()
// ç›¸å½“äº ğŸ‘‡
//ä¸¥æ ¼æ¨¡å¼
fun.call(undefined)
//éä¸¥æ ¼æ¨¡å¼
fun.call(window)
```

**ä½†æ˜¯ï¼ä½†æ˜¯ï¼ call ä¸èƒ½ä¸‡èƒ½çš„è¿™ä¹ˆæ€è€ƒ ç®­å¤´å‡½æ•°å°±ä¸æ˜¯è¿™æ ·çš„ï¼ï¼**

**ç®­å¤´å‡½æ•°æœ€åè¯´**

### ä½œä¸ºæ„é€ å‡½æ•°

```js
function Fun() {
  this.name = 'Damonre'
  this.age = 21
  this.sex = 'man'
  this.run = function () {
    return this.name + 'æ­£åœ¨è·‘æ­¥'
  }
}
Fun.prototype = {
  contructor: Fun,
  say: function () {
    return this.name + 'æ­£åœ¨è¯´è¯'
  }
}
var f = new Fun()
f.run() //Damonareæ­£åœ¨è·‘æ­¥
f.say() //Damonareæ­£åœ¨è¯´è¯
```

å¦‚ä¸Šï¼Œ**å¦‚æœå‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°ç”¨ï¼Œé‚£ä¹ˆå…¶ä¸­çš„ this å°±ä»£è¡¨å®ƒå³å°† new å‡ºæ¥çš„å¯¹è±¡**

è¿™éƒ½å½’äº new æ‰€ä½œçš„äº‹æƒ… new æ‰€ä½œçš„äº‹æƒ…å¤§è‡´å¦‚ä¸‹ï¼š

```js
function Fun() {
  //newåšçš„äº‹æƒ…
  var obj = {};
  obj.__proto__ = Fun.prototype;
  obj.name = 'Damonare';
  ...//ä¸€ç³»åˆ—èµ‹å€¼ä»¥åŠæ›´å¤šçš„äº‹
  return obj
}
```

æ‰€ä»¥ new åšäº†ä¸‹é¢è¿™äº›äº‹æƒ…ï¼Œå…¶å®å¯ä»¥ç†è§£ä¸ºè¯­æ³•ç³–ï¼Œè¿˜æ˜¯æ²¡æœ‰é€ƒè„±ä¸Šé¢æ‰€è®²çš„é‚£äº›è§„åˆ™

- åˆ›å»ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡
- ç»™ä¸´æ—¶å¯¹è±¡ç»‘å®šåŸå‹
- ç»™ä¸´æ—¶å¯¹è±¡å¯¹åº”å±æ€§èµ‹å€¼
- å°†ä¸´æ—¶å¯¹è±¡ return

### ç®­å¤´å‡½æ•°

åˆšåˆšè¯´è¿‡ï¼Œç®­å¤´å‡½æ•°ä¸èƒ½é€šè¿‡ call å’Œ apply æ”¹å˜ this çš„æŒ‡å‘,å¦‚ä¸‹

```js
var a = 1
var obj = {
  a: 2
}
var fun = () => console.log(this.a)
fun() //1
fun.call(obj) //1
```

é‚£ä¹ˆç®­å¤´å‡½æ•°çš„ this æ˜¯æ€ä¹ˆç¡®å®šçš„å‘¢ï¼Ÿ

**ç®­å¤´å‡½æ•°ä¼šæ•è·å…¶æ‰€åœ¨ä¸Šä¸‹æ–‡çš„ this å€¼ï¼Œä½œä¸ºè‡ªå·±çš„ this å€¼**ï¼Œä¹Ÿå°±æ˜¯è¯´ç®­å¤´å‡½æ•°çš„ this åœ¨è¯æ³•å±‚é¢å°±å®Œæˆäº†ç»‘å®šã€‚applyï¼Œcall æ–¹æ³•åªæ˜¯ä¼ å…¥å‚æ•°ï¼Œå´æ”¹ä¸äº† thisã€‚ çœ‹ä¸‹ä¾‹ï¼š

```js
var a = 1
var obj = {
  a: 2
}
function fun() {
  var a = 3
  let f = () => console.log(this.a)
  f()
}
fun() //1
fun.call(obj) //2
```

æ­¤å¤„ï¼Œf åœ¨å£°æ˜æ—¶çš„ this å°±æ˜¯å®ƒçš„ä¸Šä¸‹æ–‡ thisï¼Œå®ƒçš„ä¸Šä¸‹æ–‡æ—¶ funï¼Œè€Œ fun çš„ä¸Šä¸‹æ–‡ this æ˜¯ windowï¼Œæ‰€ä»¥ f çš„ this ä¹Ÿæ˜¯ windowã€‚

ä½†æ˜¯å½“æ‰§è¡Œ`fun.call(obj)`ä¹‹åï¼Œfun ä¸Šä¸‹æ–‡çš„ this å°±æŒ‡å‘äº† objï¼Œæ‰€ä»¥ f çš„ this å˜æˆäº† obj

å†çœ‹ä¸¤ä¸ªæ¯”è¾ƒæçš„ä¾‹å­ï¼š

```js
function Fun() {
  this.name = 'Damonare'
}
Fun.prototype.say = () => {
  console.log(this)
}
var f = new Fun()
f.say() //window
```

æ­¤å¤„è™½ç„¶ say çš„è°ƒç”¨è€…æ˜¯ fï¼Œä½†æ˜¯ say æ˜¯ç®­å¤´å‡½æ•°ï¼Œå®ƒçš„ this åœ¨è¯æ³•å±‚é¢æ—¶çš„ä¸Šä¸‹æ–‡æ˜¯ Fun æ„é€ å‡½æ•°çš„åŸå‹çš„ä¸Šä¸‹æ–‡ï¼Œå¾ªç€åŸå‹é“¾å¾€ä¸Šï¼Œå°±æ˜¯ Object å‡½æ•°çš„ä¸Šä¸‹æ–‡ï¼Œthis å°±æ˜¯å…¨å±€å¯¹è±¡ window

å†çœ‹ä¸‹ä¸€ä¸ªï¼š

```js
function Fun() {
  this.name = 'Damonare'
  this.say = () => {
    console.log(this)
  }
}
var f = new Fun()
f.say() //Funçš„å®ä¾‹å¯¹è±¡ f
```

æ­¤æ—¶ this åœ¨è¯æ³•å±‚é¢æ—¶ï¼Œå®ƒçš„ this å°±æ˜¯ this.say çš„ä¸Šä¸‹æ–‡ï¼Œä¹Ÿå°±æ˜¯ Fun çš„ä¸Šä¸‹æ–‡ï¼Œè€Œ Fun ä½œä¸ºæ„é€ å‡½æ•°ï¼Œthis æŒ‡å‘å³å°† new å‡ºæ¥çš„å¯¹è±¡ï¼Œæ‰€ä»¥æ­¤å¤„çš„ this æŒ‡å‘å®ä¾‹å¯¹è±¡ f

å‚è€ƒï¼š
[JavaScript ä¸­çš„ this](https://juejin.cn/post/6844903488304971789#heading-0)
